<section class="relative py-16 sm:py-20 bg-cta-dark overflow-hidden" aria-label="{{ 'newsletter.title'|trans }}">
    {# Decorative background elements #}
    <div class="absolute top-0 right-0 w-72 h-72 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/3" aria-hidden="true"></div>
    <div class="absolute bottom-0 left-0 w-56 h-56 bg-cta-light/10 rounded-full translate-y-1/3 -translate-x-1/4" aria-hidden="true"></div>

    <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row items-center gap-10 lg:gap-16">
            {# Text + Form #}
            <div class="flex-1 text-center lg:text-left"
                 x-data="{
                     email: '',
                     status: 'idle',
                     message: '',
                     async subscribe() {
                         if (!this.email) return;
                         this.status = 'loading';
                         try {
                             const formData = new FormData();
                             formData.append('action', 'newsletter_subscribe');
                             formData.append('nonce', wpData.newsletterNonce);
                             formData.append('email', this.email);
                             const response = await fetch(wpData.ajaxUrl, { method: 'POST', body: formData });
                             const result = await response.json();
                             if (result.success) {
                                 this.status = 'success';
                                 this.message = result.data.message;
                                 this.email = '';
                             } else {
                                 this.status = 'error';
                                 this.message = result.data?.message || 'Une erreur est survenue.';
                             }
                         } catch {
                             this.status = 'error';
                             this.message = 'Une erreur est survenue.';
                         }
                     }
                 }">
                <h2 class="text-3xl sm:text-4xl font-bold text-white mb-4 text-balance">
                    {{ 'newsletter.title'|trans }}
                </h2>
                <p class="text-lg text-white/80 mb-8 max-w-xl mx-auto lg:mx-0">
                    {{ 'newsletter.data_care'|trans }}
                    <a href="https://visitmarche.be/fr/politique-de-confidentialite"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="underline underline-offset-2 hover:text-white transition-colors duration-200">
                        {{ 'newsletter.read_charter'|trans }}
                    </a>
                </p>

                {# Success message #}
                <div x-show="status === 'success'" x-cloak
                     class="mb-6 rounded-xl bg-white/15 backdrop-blur-sm px-5 py-4 text-white font-medium"
                     role="status">
                    <span x-text="message"></span>
                </div>

                {# Error message #}
                <div x-show="status === 'error'" x-cloak
                     class="mb-6 rounded-xl bg-cta-light/30 backdrop-blur-sm px-5 py-4 text-white font-medium"
                     role="alert">
                    <span x-text="message"></span>
                </div>

                <form @submit.prevent="subscribe()" x-show="status !== 'success'">
                    <div class="flex flex-col sm:flex-row gap-3 max-w-lg mx-auto lg:mx-0">
                        <label for="email-address" class="sr-only">{{ 'newsletter.email_label'|trans }}</label>
                        <input id="email-address" name="email" type="email" autocomplete="email" required
                               spellcheck="false"
                               x-model="email"
                               placeholder="{{ 'newsletter.email_placeholder'|trans }}"
                               class="flex-1 rounded-xl border-0 px-5 py-3.5 text-base text-gray-800
                                      placeholder:text-grey-basic
                                      shadow-sm
                                      focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-cta-light/50">
                        <button type="submit"
                                :disabled="status === 'loading'"
                                class="inline-flex items-center justify-center gap-2
                                       rounded-xl bg-cta-light px-7 py-3.5
                                       text-base font-semibold text-white
                                       shadow-sm
                                       motion-safe:hover:-translate-y-0.5 hover:bg-cta-light/85
                                       active:translate-y-0
                                       transition-[color,background-color,transform,box-shadow] duration-200
                                       focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-cta-light/50 focus-visible:ring-offset-2 focus-visible:ring-offset-cta-dark
                                       disabled:opacity-60 disabled:cursor-wait">
                            <span x-show="status !== 'loading'">{{ 'newsletter.subscribe'|trans }}</span>
                            <span x-show="status === 'loading'" x-cloak>{{ 'newsletter.sending'|trans }}</span>
                            <svg x-show="status !== 'loading'" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"/>
                            </svg>
                            <svg x-show="status === 'loading'" x-cloak class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24" aria-hidden="true">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>

            {# Mascot image #}
            <div class="shrink-0 hidden lg:block">
                <img src="{{ template_uri() }}/assets/tartine/george2.png"
                     alt="crieur"
                     width="408" height="361"
                     class="w-48 xl:w-56 h-auto drop-shadow-lg"
                     loading="lazy"/>
            </div>
        </div>
    </div>
</section>
